### FukuiNet: Chebyshev Graph-Based KAN for Molecular Reactivity Prediction

Abstract (Аннотация)
	•	Стиль: Краткий обзор содержания статьи (150-250 слов).
	•	Необходимые элементы: Введение в проблему, цель исследования, основные методы, ключевые результаты и заключение.
	•	Заголовок: Abstract
Keywords: Molecular Reactivity, Fukui Index, Graph Neural Networks, Chebyshev Polynomials, Kernel-based Attention Network

### Введение

В последние годы в области вычислительной химии и молекулярного моделирования наблюдается значительный прогресс благодаря развитию методов машинного обучения (ML). Эти методы позволяют значительно сократить время и ресурсы, необходимые для предсказания различных молекулярных свойств, таких как реакционная способность, электрофильность и другие. Одним из ключевых параметров, влияющих на реакционную способность молекул, являются индексы Фукуи, которые характеризуют распределение заряда в молекуле и указывают на наиболее вероятные точки атаки в химических реакциях.

Традиционно индексы Фукуи вычисляются с помощью методов квантовой химии, таких как плотностный функционал (DFT), что требует значительных вычислительных затрат и времени. С ростом объема данных и улучшением моделей машинного обучения, появилась возможность использовать эти данные для ускорения предсказания молекулярных свойств. В данном исследовании мы предлагаем новый подход под названием **FukuiNet**, который использует архитектуру графовых нейронных сетей (GNN) на основе Чебышевских полиномов и метода Kernel-based Attention Network (KAN) для эффективного предсказания индексов Фукуи.

Мы используем модифицированную версию набора данных **QM_9**, названную **QM_137k**, которая включает как оригинальные квантовые дескрипторы из статьи "Regio-selectivity prediction with a machine-learned reaction representation and on-the-fly quantum mechanical descriptors" [1], так и расчетный нами общий дескриптор CDD (The Condensed Dual Descriptor). CDD представляет собой модификацию исходных данных, основанную на комбинации зарядов Хиршфельда и индексов Фукуи в электронных и нейтральных состояниях, что позволяет улучшить точность предсказания химической реакционной способности.

Таким образом, целью данного исследования является разработка эффективного метода предсказания индексов Фукуи на основе графовых нейронных сетей, который способен заменить традиционные методы квантовой химии в ряде применений, обеспечивая при этом высокую точность и производительность.


### Литературный обзор

Методы машинного обучения, особенно графовые нейронные сети (GNN), стали важным инструментом в вычислительной химии для предсказания различных молекулярных свойств. Эти методы активно развиваются и используются для решения задач, требующих учета сложных взаимодействий между атомами в молекулах.

#### 1. **Применение методов машинного обучения в квантовой химии**

В квантовой химии на протяжении последних десятилетий активно разрабатывались методы, направленные на предсказание молекулярных свойств с использованием машинного обучения. Один из таких методов - **Chemprop** - представляет собой пакет для предсказания химических свойств на основе графовых нейронных сетей. Он использует атомные признаки (атомные номера, состояния гибридизации, окружение и т.д.) для построения графовых представлений молекул, что позволяет учитывать взаимодействия между атомами на более глубоком уровне [1]. Chemprop продемонстрировал высокую точность предсказания таких свойств, как солюбильность, реакционная способность и токсичность, что делает его мощным инструментом для моделирования химических систем.

Одним из ключевых преимуществ использования атомных признаков в графовых нейронных сетях является возможность учета локальных и нелокальных взаимодействий между атомами в молекуле. В отличие от методов, основанных на молекулярных фичах (например, физико-химических дескрипторов), которые могут терять важную информацию о взаимодействиях на атомарном уровне, графовые подходы позволяют более точно моделировать электронную структуру и реакционную способность молекул. Это особенно важно для задач, связанных с предсказанием реакционной способности и селективности в химических реакциях.

#### 2. **Исследования по использованию атомных признаков**

Использование атомных признаков в моделировании молекулярных свойств активно изучается в последние годы. Например, исследование, проведенное Guan et al. [2], предложило метод предсказания региоселективности реакций с использованием представлений реакций, полученных на основе машинного обучения и квантово-механических дескрипторов "на лету". Этот подход позволил значительно улучшить точность предсказания по сравнению с традиционными методами.

Еще одним значимым исследованием является работа Wu et al. [3], в которой используется концепция графовых сверток для моделирования молекулярных свойств. Здесь применяются графовые нейронные сети для предсказания молекулярных орбиталей и других квантово-химических свойств, что позволяет получить высокоточную модель с минимальными вычислительными затратами.

#### 3. **Преимущества графовых подходов для предсказания молекулярных свойств**

Графовые подходы, основанные на использовании атомных признаков, доказали свою эффективность и превосходство над традиционными методами для предсказания сложных молекулярных свойств. Эти методы учитывают всю сложность атомных взаимодействий, что делает их особенно полезными для задач, связанных с предсказанием реакционной способности, селективности, а также других свойств, критически важных для разработки новых материалов и лекарственных соединений.

Таким образом, использование атомных признаков в графовых нейронных сетях представляет собой важное направление в современных исследованиях по предсказанию молекулярных свойств. Этот подход обеспечивает более точное и комплексное моделирование молекулярных систем, что способствует значительному прогрессу в области квантовой химии и химической информатики.

---

**Ссылки:**

1. **Chemprop:** Yang, K., Swanson, K., Jin, W., Coley, C. W., Eiden, P., Gao, H., ... & Jaakkola, T. (2019). Analyzing Learned Molecular Representations for Property Prediction. *Journal of Chemical Information and Modeling*, 59(8), 3370-3388.
  
2. **Regio-selectivity prediction:** Guan, Y., Coley, C. W., Wu, H., Ranasinghe, D., Heid, E., Struble, T. J., Pattanaik, L., Green, W. H., & Jensen, K. F. (2021). Regio-selectivity prediction with a machine-learned reaction representation and on-the-fly quantum mechanical descriptors. *Chemical Science*, 12(2), 567-576.

3. **Graph Convolutional Networks:** Wu, Z., Ramsundar, B., Feinberg, E. N., Gomes, J., Geniesse, C., Pappu, A. S., ... & Pande, V. S. (2018). MoleculeNet: A benchmark for molecular machine learning. *Chemical Science*, 9(2), 513-530.

### Химия

#### Важность конформационной подвижности

Конформационная подвижность молекулы является ключевым фактором, определяющим ее термодинамические и кинетические характеристики. Конформации — это разные пространственные изомеры, которые возникают вследствие вращения вокруг одинарных σ-связей. Эти изомеры могут существенно различаться по энергии, что влияет на вероятность их присутствия в термодинамическом равновесии. Конформационная подвижность напрямую влияет на распределение электронной плотности и реакционную способность молекулы, так как различия в пространственном расположении атомов приводят к изменениям в электронной структуре и межатомных взаимодействиях.

На молекулярном уровне конформационные изменения могут приводить к существенным вариациям в энергии активации химических реакций. Например, молекулы с высокой конформационной подвижностью могут демонстрировать разные реакционные пути в зависимости от их конкретной конформации в момент взаимодействия с реагентом. Это особенно важно для молекул, содержащих несколько функциональных групп, которые могут взаимодействовать друг с другом, создавая внутримолекулярные взаимодействия, такие как водородные связи или π-π стэкинг. Эти взаимодействия могут стабилизировать определенные конформации, влияя на их реакционную способность.

Для молекул, таких как биомолекулы или крупные органические соединения, конформационная подвижность критически важна для их биологической активности и специфичности. Например, в ферментативных реакциях конформационная подвижность активного центра фермента может определять его способность к связыванию субстрата и катализу реакции. В контексте квантово-химических расчетов учет конформационной подвижности позволяет более точно моделировать молекулярные системы и предсказывать их поведение в различных химических и биологических процессах.

#### Определение через три состояния

Для полного описания молекулярной реакционной способности и электрохимических свойств необходимо учитывать изменения электронной структуры при переходе между несколькими валентными состояниями. Подход, использующий три состояния — нейтральное, катионное (после удаления электрона) и анионное (после присоединения электрона), позволяет всесторонне исследовать изменение электронной плотности и заряда в молекуле.

Этот подход особенно важен для расчета индексов Фукуи, которые являются локальными дескрипторами реакционной способности молекул. Индексы Фукуи \( f^+ \) и \( f^- \) рассчитываются для катионного и анионного состояний соответственно, и представляют собой производные функции электронного распределения по отношению к изменению числа электронов:

\[
f^+(\mathbf{r}) = \rho_{\text{N}}(\mathbf{r}) - \rho_{\text{N-1}}(\mathbf{r})
\]
\[
f^-(\mathbf{r}) = \rho_{\text{N+1}}(\mathbf{r}) - \rho_{\text{N}}(\mathbf{r})
\]

где \( \rho_{\text{N}}(\mathbf{r}) \) — это электронная плотность в нейтральном состоянии, \( \rho_{\text{N-1}}(\mathbf{r}) \) — в катионном состоянии, а \( \rho_{\text{N+1}}(\mathbf{r}) \) — в анионном состоянии.

Учет трех состояний позволяет более точно моделировать реакции, связанные с переносом заряда, такие как нуклеофильные или электрофильные атаки, где электронные переходы играют ключевую роль. Например, в органической химии многие реакции, такие как электрофильное ароматическое замещение, требуют учета как потери, так и приобретения электронов. Рассмотрение трех состояний обеспечивает всесторонний анализ распределения электронной плотности в молекуле, что приводит к более точным предсказаниям реакционной способности и потенциальных точек атаки.

Кроме того, такие расчеты позволяют предсказывать реакционные центры с высокой точностью, что имеет решающее значение для разработки новых молекул с целевыми свойствами, таких как ингибиторы ферментов или катализаторы. Этот подход также полезен для оценки устойчивости молекул к окислению или восстановлению, что важно для материаловедения и электрохимии.

Таким образом, учет конформационной подвижности и определение молекулярных свойств через три валентных состояния позволяет глубже понять природу химических взаимодействий и разработать более точные модели для предсказания реакционной способности молекул.


### База данных (тут описать датасет и что делали)
### Подготовка данных

Для проведения нашего исследования был использован модифицированный набор данных **QM_137k**, который представляет собой расширенную и улучшенную версию оригинального набора данных, основанного на популярной базе **QM9**. Оригинальный набор данных **QM9** содержит квантово-механические дескрипторы для более чем 130 000 малых органических молекул, что делает его одним из самых широко используемых наборов данных в квантовой химии и машинном обучении. На основе данных из **QM9** был создан набор **QM_137k**, включающий дополнительные дескрипторы, такие как индексы Фукуи и заряды Хиршфельда.

Модифицированная версия **QM_137k** была создана путем удаления избыточных данных, не связанных напрямую с задачей предсказания молекулярной реакционной способности, и добавления нового дескриптора — **Conduction Dual Descriptor (CDD)**. CDD представляет собой линейную комбинацию зарядов Хиршфельда и индексов Фукуи, как для электронного, так и для нейтрального состояний, что позволяет учитывать ключевые аспекты распределения электронной плотности и реакционной способности молекул. Формула для расчета CDD выглядит следующим образом:

\[
\text{CDD} = 2 \times \text{hirshfeld\_charges} - \text{hirshfeld\_fukui\_elec} - \text{hirshfeld\_fukui\_neu}
\]

Этот дескриптор был специально разработан для повышения эффективности предсказаний молекулярной реакционной способности и селективности. Важно отметить, что значения некоторых дескрипторов были подвергнуты логарифмическому преобразованию с целью смягчения экстремальных значений и улучшения сходимости моделей. Это преобразование позволило уменьшить влияние выбросов и сделать модель более устойчивой к изменениям в данных.

После формирования нового набора данных был проведен процесс его предобработки, включающий стандартизацию форматов данных, удаление потенциальных выбросов и аномалий, а также приведение данных к формату, оптимальному для последующего машинного обучения. Особое внимание уделялось проверке и корректировке структур молекул, представленных в формате SMILES, с целью обеспечения их правильной геометрической и электронной конфигурации. В результате этих шагов был создан готовый к использованию набор данных, который впоследствии использовался для обучения модели **FukuiNet**.

Место для четырех графиков: Визуализация распределения значений CDD до и после логарифмического преобразования, а также сравнительный анализ распределений других ключевых дескрипторов.

Этот модифицированный и предобработанный набор данных сыграл ключевую роль в обеспечении высокой точности и производительности нашей модели при предсказании индексов Фукуи и других критически важных молекулярных параметров.


СДЕЛАТЬ распределение для нашей бд и как получили

СДЕЛАТЬ описание пайплайна взяли лекарства из 1 2 фазы с чембла 
расчитали через из смайлсов в mopac оптимизация затем orca 5 
получившиеся результаты орбиталей в janpa сумировали 
надо на зенодо запостить

https://zenodo.org/records/13341972

The dataset "QM_137k.parquet" is a modified version of the original dataset published as part of the supporting information for the paper *"Regio-selectivity prediction with a machine-learned reaction representation and on-the-fly quantum mechanical descriptors"* by Yanfei Guan, Connor W. Coley, Haoyang Wu, Duminda Ranasinghe, Esther Heid, Thomas J. Struble, Lagnajit Pattanaik, William H. Green, and Klavs F. Jensen from MIT. The original dataset, accessible via [Figshare](https://figshare.com/articles/dataset/QM_137k_training_pkl_gz/12818702/1), contains quantum mechanical descriptors for 137,000 molecules, intended for use in multi-task constraining models.

This version of the dataset has been curated and streamlined by removing extraneous data and adding the Conduction Dual Descriptor (CDD). The CDD was calculated using the formula:

\[
\text{CDD} = 2 \times \text{hirshfeld\_charges} - \text{hirshfeld\_fukui\_elec} - \text{hirshfeld\_fukui\_neu}
\]

where the CDD leverages Hirshfeld charges and Fukui indices (both electron and neutral forms) to enhance the dataset's applicability for reactivity predictions. This enriched dataset is particularly useful for studies focusing on molecular reactivity and regio-selectivity predictions.

### Модель

Для обучения модели **FukuiNet** использовался набор данных **QM_137k**, содержащий квантово-механические дескрипторы для 137 000 молекул. Модель была обучена с использованием 5-фолдовой кросс-валидации для оценки ее стабильности и обобщающей способности.

Модель была настроена на основе следующих параметров. Для входных данных использовалось 128 признаков атомов, а выходной размерностью было предсказание скалярного значения (например, индекса Фукуи). Размер батча составлял 1024, что обеспечивало оптимальный баланс между эффективностью вычислений и использованием памяти, при этом данные загружались параллельно с использованием восьми рабочих потоков.

Архитектура модели включала 9 скрытых слоев на этапе предобработки и 2 скрытых слоя на этапе постобработки, каждый из которых имел 128 нейронов. Для обработки графовой структуры молекулы использовались два слоя Чебышёвской свертки с порядками полиномов 10 и 16, а также симметричной нормализацией. Все слои модели использовали параметрическую ReLU (PReLU) в качестве функции активации и пакетную нормализацию для улучшения стабильности обучения.

В качестве оптимизатора был выбран **Lion** с низкой скоростью обучения 2.2e-5 и регуляризацией веса 3e-5 для предотвращения переобучения. Шаг уменьшения скорости обучения был установлен на 80 шагов, после чего скорость уменьшалась в 5 раз. Основной метрикой для оценки модели была выбрана корень из средней квадратичной ошибки (RMSE), что позволило точно измерить среднюю ошибку предсказаний.

Эти параметры были оптимизированы для достижения высокой точности модели на задачах предсказания молекулярных свойств, обеспечивая устойчивость и точность результатов на всех этапах обучения.

красивая картинка архитектуры
использовали KAN он быстрее 
линейных слоев 

в кан можно увидеть формулы (сделать) 


как основа чебышев torch скатер для обьединения лион как оптимайзер

Что пробовали чебышев гат тенгоры и тд (сводная таблица в саплиментари)
https://github.com/Blealtan/efficient-kan

### результаты 

сделали точнее чем существующий резульат (пример статья)

### Добавить результат в конду и пип
